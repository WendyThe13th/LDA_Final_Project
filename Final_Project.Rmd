---
title: "Final_Project"
author: "Mengqi Zhu"
date: "2018/11/29"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr) 
library(lme4)
library(janitor)
library(corrplot)
library(ggplot2)
library(broom)
library(mice)
```

```{r}
smoke <- read.csv(file = 'frmgham2.csv') %>% 
  clean_names()
```


Figure 1 shows that as individuals age, the likelihood that they are smoking decreases. We can see that when we breaking individuals down by sex, it appears that the overall trend is the same between sexes with males having an overall higher likelihood of being smokers as age increases. 

```{r}

smoke %>%
  ggplot(aes(age, cigpday)) +
  geom_jitter(height = 0.1) +
  stat_summary(fun.y = mean, geom = "line", col = 'red') +
  ggtitle("Figure 1: Current Smoking Status across Age")


##FIGURE OF INTEREST
smoke %>%
  ggplot(aes(age, cursmoke, group = sex)) +
  geom_jitter(height = 0.1, size = 0.5) +
  stat_summary(fun.y = mean, geom = "line", aes(color=paste("mean", sex))) +
  ggtitle("Figure 2: Current Smoking Status across Age") +
  scale_colour_hue(name = "Sex", labels = c("Male", "Female"))


#longitudinal plot
smoke %>%
  mutate(cursmoke = as.factor(cursmoke),
         sex = as.factor(sex)) %>%
  group_by(period, sex) %>%
  count(cursmoke) %>%
  ggplot(aes(period, n, group = cursmoke, color = cursmoke)) +
  geom_line() +
  facet_wrap(~sex) +
  ggtitle("Figure 3: Current Smoking status across Period by Sex") #period = visit

```

When looking at cigarette packs smoked per day, it appears that the number steadily decreases as individuals get older. The trend once again is the same in each sex however females are smoking less packs a day overall.

```{r}

smoke %>%
  ggplot(aes(age, cigpday)) +
  
  stat_summary(fun.y = mean, geom = "line", size = 0.8, col = 'red') +
  ggtitle("Figure 4: Packs a Day across Age")

smoke %>%
  
  ggplot(aes(age, cigpday, group = sex)) +
  
  stat_summary(fun.y = mean, geom = "line", size = 0.8, aes(color=paste("mean", sex))) +
  geom_smooth(se=FALSE) +
  ggtitle("Figure 5: Cigarettes per Day across Age") +
  scale_colour_hue(name = "Sex", labels = c("Male", "Female")) 
```


In Figure 5, we see that as systolic blood pressure increases the likelihood of smoking decreases. The trend is not as profound in Figure 6 with diastolic BP or with serum total cholesterol in Figure 7. 

```{r}

smoke %>%
  ggplot(aes(sysbp, cursmoke)) +
  geom_jitter(height = 0.1) +
  geom_smooth(color = 'red') +
  ggtitle("Figure 6: Current Smoking Status across Systolic Blood Pressure")

smoke %>%
  ggplot(aes(diabp, cursmoke)) +
  geom_jitter(height = 0.1) +
  geom_smooth(color = 'red') +
  ggtitle("Figure 7: Current Smoking Status across Diastolic Blood Pressure")

smoke %>%
  ggplot(aes(diabp, cursmoke)) +
  geom_jitter(height = 0.1) +
  geom_smooth(color = 'red') +
  ggtitle("Figure 8: Current Smoking Status across Serum Total Cholestserol")
```

#Corrplot 1
It appears that the only significant correlation between the variables of interest is between the two BP measurements and systolic BP and age with a value of 0.39. There is negative correlation between age and smoking status, meaning that the smokers appear to be correlated with youger aged individuals.  

#Corrplot 2
Obvious correlations include BP measurements between bpmeds and prevhyp, age and death, glucose and diabetes, etc. Prevvap was correlated with prevmi and prevchd. Our variable of interest totchol was very highly correlated with ldlc. 

#Corrplot3 
When evaluating the different follow up conditions, most are highly correlated with each other with the exception of hypertension not being correlated with any other condition and stroke only being correlated to cvd at 0.55. BPs are correlated with hypertension

```{r}

#correlation between all interested variables
corr =  smoke %>% 
  dplyr::select(age, cursmoke, sex, sysbp, diabp, totchol) %>%  
  mutate(totchol = as.numeric(totchol)) %>%
  na.omit()

corrplot(cor(corr), method="number",shade.col=NA, tl.col="black", tl.srt=65)


corr2 =  smoke %>% 
  dplyr::select(-randid, -period,  -25:-39) %>%  
  na.omit()

corrplot(cor(corr2), method="number",shade.col=NA, tl.col="black", tl.srt=65)


corr3 =  smoke %>% 
  dplyr::select(25:31) %>%  
  na.omit()

corrplot(cor(corr3), method="number",shade.col=NA, tl.col="black", tl.srt=65)
```



```{r}
#checking missing values (5% rule)
pMiss <- function(x){sum(is.na(x))/length(x)*100}
apply(smoke,2,pMiss) #2 indicates columns
#Remove hdlc, ldlc, glucose, and bpmeds for having more than 5% of missing values.
```
It is okay as hdlc, ldlc are highly correlated with totchol, glucose is highy correlated with diabetes, bmmeds is highly correlated with sysbp and diabp. Therefore it won't lose much information to just drop these features.
```{r}
smoke_na_omit = smoke %>%
  select(-hdlc,-ldlc,-glucose,-bpmeds) %>%
  na.omit()
```

Variable Selection and confounder identidication:
# Question 1

```{r}
smoke_vs1 = smoke %>% 
  filter(period==1) %>% 
  dplyr::select(c(randid,sex,age,cursmoke,totchol,bmi,heartrte,educ,diabp,sysbp,diabetes)) %>% 
  mutate(cursmoke = as.factor(cursmoke), sex=as.factor(sex), diabetes=as.factor(diabetes)) %>% 
  na.omit()
```


```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+totchol, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
totchol is not confounder for sex and age with cursmoke



```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+sysbp, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
sysbp is not confounder for sex and age with cursmoke

```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+diabp, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
diabp is is not confounder for sex and age with cursmoke

```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+bmi, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
bmi is is not confounder for sex and age with cursmoke

```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+heartrte, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
heartrte is is not confounder for sex and age with cursmoke

```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+educ, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
educ is  not confounder for sex and age with cursmoke

```{r}
glm1 <- glm(cursmoke ~ age+sex, data=smoke_vs1,family = 'binomial')
glm2 <- glm(cursmoke ~ age+sex+diabetes, data=smoke_vs1,family = 'binomial')
a=(summary(glm1)$coefficients[2])-(1.96 * (summary(glm1)$coefficients[5])) 
b= (summary(glm1)$coefficients[2])+(1.96 * (summary(glm1)$coefficients[5]))
c=summary(glm2)$coefficients[2]
exp(a)
exp(b)
exp(c)
!(exp(c)>=exp(a) & exp(c)<=exp(b))
d=(summary(glm1)$coefficients[3])-(1.96 * (summary(glm1)$coefficients[6]))
e=(summary(glm1)$coefficients[3])+(1.96 * (summary(glm1)$coefficients[6]))
f=summary(glm2)$coefficients[3]
exp(d)
exp(e)
exp(f)
!(exp(f)>=exp(d) & exp(f)<=exp(e))
```
diabetes is not confounder for sex and age with cursmoke

Using backward elimination:
```{r}


#(1)
###backward elimination###

back.fit <- glm(cursmoke ~ .-randid, data=smoke_vs1,family = 'binomial')
summary(back.fit)
#We then take out the variables with the highest p-value:

step1 <-update(back.fit, . ~ . -sysbp)
summary(step1)

step2 <-update(step1, . ~ . -diabetes)
summary(step2)

#result from backward elimination:
#cursmoke ~ age + sex + totchol + bmi + educ + diabp + heartrte

#only backward elimination is recommeded in case of binary outcome

```


#Question 2


Variable Selection and confounder identidication:

```{r}
smoke_vs2 = smoke %>% 
  filter(period==1) %>% 
  dplyr::select(c(randid,sex,age,cigpday,totchol,bmi,heartrte,educ,diabp,sysbp,diabetes)) %>% 
  mutate(sex=as.factor(sex), diabetes=as.factor(diabetes)) %>% 
  na.omit()
```

```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+totchol, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
totchol is not confounder for age and sex with cigpday

```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+bmi, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
bmi is not confounder for age and sex with cigpday


```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+heartrte, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
heartrte is not confounder for age and sex with cigpday


```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+educ, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
educ is not confounder for age and sex with cigpday

```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+diabp, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
diabp is not confounder for age and sex with cigpday
```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+sysbp, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
sysbp is not confounder for age and sex with cigpday


```{r}
lm1 <- lm(cigpday ~ age+sex, data=smoke_vs2)
lm2 <- lm(cigpday ~ age+sex+diabetes, data=smoke_vs2)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[5])) 
b= (summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[5]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c=a & c<=b)
d=(summary(lm1)$coefficients[3])-(1.96 * (summary(lm1)$coefficients[6]))
e=(summary(lm1)$coefficients[3])+(1.96 * (summary(lm1)$coefficients[6]))
f=summary(lm2)$coefficients[3]
d
e
f
!(f>=d & f<=e)
```
diabetes is not confounder for age and sex with cigpday




```{r}
#(2)


###backward elimination###

back.fit2 <- lm(cigpday ~ .-randid, data=smoke_vs2)
summary(back.fit2)

step1 <-update(back.fit2, . ~ . -sysbp)
summary(step1)

step2 <-update(step1, . ~ . -diabetes)
summary(step2)
#result from backward elimination:
#full model
#cigpday ~ age + sex + totchol + bmi + educ + diabp + heartrte
```

#Question 3
```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + sex, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
sex is not confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + age, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
age is not confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + totchol, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
totchol is not confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + bmi, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
bmi is confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + heartrte, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
heartrte is not confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + educ, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
educ is not confounder

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + diabp, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
diabp is confounder(it is highly correlated with sysbp, how to interpret this?)

```{r}
lm1 <- lm(sysbp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(sysbp ~ cursmoke + diabetes, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
diabetes is not confounder


```{r}
#Backward elimination for cursmoke vs. systolic blood pressure

back.fit3 <- lm(sysbp ~ .-randid, data=smoke_vs1)
summary(back.fit3)
#We then take out the variables with the highest p-value:

step1 <-update(back.fit3, . ~ . -totchol)
summary(step1)

#Although "cursmoke" is insignificant here, we will not remove it since it is our main variable of interest.

step2 <-update(step1, . ~ . -bmi)
summary(step2)

#result from backward elimination:
#sysbp ~ age + sex + cursmoke_1 + educ + diabp + heartrte + diabetes

```


#Question 4
```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + sex, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
sex is not confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + age, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
age is confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + totchol, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
totchol is not confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + bmi, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
bmi is confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + heartrte, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
heartrte is not confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + educ, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
educ is not confounder

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + sysbp, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
sysbp is confounder(it is highly correlated with diabp, how to interpret this?)

```{r}
lm1 <- lm(diabp ~ cursmoke, data=smoke_vs1)
lm2 <- lm(diabp ~ cursmoke + diabetes, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
diabetes is not confounder


```{r}
#Backward elimination for cursmoke vs. diastolic blood pressure

back.fit4 <- lm(diabp ~ .-randid, data=smoke_vs1)
summary(back.fit4)

# All variables are significant. 

#result from backward elimination:
#diabp ~ age + sex + cursmoke_1 + educ + diabp + heartrte + diabetes + bmi + totchol

```


#QUestion 5
```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + sex, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
sex is not confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + age, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
age is confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + diabp, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
diabp is not confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + bmi, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
bmi is confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + heartrte, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
heartrte is not confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + educ, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
educ is not confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + sysbp, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
sysbp is not confounder

```{r}
lm1 <- lm(totchol ~ cursmoke, data=smoke_vs1)
lm2 <- lm(totchol ~ cursmoke + diabetes, data=smoke_vs1)
a=(summary(lm1)$coefficients[2])-(1.96 * (summary(lm1)$coefficients[4])) 
b=(summary(lm1)$coefficients[2])+(1.96 * (summary(lm1)$coefficients[4]))
c=summary(lm2)$coefficients[2]
a
b
c
!(c>=a & c<=b)
```
diabetes is not confounder



```{r}
#Backward elimination for cursmoke vs. serum total cholesterol

back.fit5 <- lm(totchol ~ .-randid, data=smoke_vs1)
summary(back.fit5)

step1 <-update(back.fit5, . ~ . -diabetes)
summary(step1)

step2 <-update(step1, . ~ . -sysbp)
summary(step2)

#result from backward elimination:
#totchol ~ age + sex + cursmoke_1 + educ + diabp + heartrte + bmi

```

```{r}
#Vars with missing values for imputation
smoke2 = smoke %>% 
  dplyr::select(c(cursmoke,bmi,educ,diabp,age,sex,heartrte,totchol,cigpday,diabetes,sysbp))
summary(smoke2)
#imputation using predictive mean matching
imputed.smoke <- mice(smoke2,m=5,maxit=50,meth='pmm',seed=500)
#summary(imputed.smoke)

#return to completed dataset
completedData <- complete(imputed.smoke,1)
completedData$randid = smoke$randid
summary(completedData)
```


